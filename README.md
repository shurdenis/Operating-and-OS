# Ansible сценарий отказоустойчивого Postgres кластера (Patroni + consul) на виртуальной машине под управлением РЕД ОС

## При запуске главного плэйбука sirius.yml: 
### 1. Из встроенного репозитория устанавливается Consul
### 2. Создается volume group "PG" (/dev/sdb and /dev/sdc) 
### 3. Создается Logical volume group pg_data (/dev/sdb) и pg_wal (/dev/sdc) и они форматируются в формат файловой системы ext4
### 4. Устанавливается из rpm пакета Patroni 2.1.3.1
### 5. Создаются и монтируются необходимые директории пользователь (postgres, права 700) pgsql/pg_data (в ней находится БД) и pgsql/pg_wal (в ней хранятся WAL архивы)
### 6. Создается директория с log файлами Patroni и копируется из Template файла конфиг Patroni в директорию /opt/app/patroni/etc
### 7. Запускается Patroni
### 8. Устанавливается VIP-менеджер
### 9. Копируется и заносится в переменную consul_key_read ключ доступа к Consul
### 10. Копируется из Template файла конфиг Consul в директорию /etc/default
---
## Все переменные находятся в group_vars
